---
layout: post
title:  "천지인 키보드의 Middle Dot과 관련된 이슈"
date:   2020-06-21 23:44:00 +0900
categories: issue
tags: [모바일, 가상키보드, 천지인, 정규식, 이슈]
---
## 요약
> * 천지인의 모음입력에 쓰이는 middle dot은 `\u318D\u119E\u11A2\u2022\u2025\u00B7\uFE55` 요정도가 있습니다.
> * 아이폰에도 천지인 키보드가 있습니다. 
> * 아이폰의 천지인 키보드는 `\u1100-\u1112` 의 유니코드 한글자모 영역에 속하는 문자까지 추가해줘야 합니다.

## 특수문자를 제한하고 싶어요
당시 구현하던 모바일 웹페이지에는 사용자가 직접 내용을 입력할 수 있는 `textarea`가 있었습니다.

별다른 생각없이 요구사항대로 글자 수 제한 등을 구현하고 있었는데, 구현하다보니 특수문자 입력을 제한하는 요구사항이 있더군요. 당시 요구사항은 특정한 특수문자를 제한했으면 좋겠다는 요구사항이 아니라 그 반대였습니다.

> 문서 : 특정 특수문자만 입력 가능하도록 해주세요

네. 그럼요. 얼마든지요.
어떤식으로 제어를 할까 고민하다가 `input`이벤트에서 정규식을 이용해 필터링을 하기로 하였습니다.

```js
// 아래 정규식에 해당하는 내용 외의 문자들을 걸러내는 용도로 사용합니다.
const regex = /[^ㄱ-ㅎㅏ-ㅣ가-힣a-zA-Z0-9₩~!@#$%^&*()_+\-=[\]{}`<>,.?/|\\'":;\s]/g
```

## 불행의 서막
이미 예상하고 있으신 분들도 있겠지만, 모바일 디바이스의 가상키보드는 예상치못한 문자를 입력해주기도 합니다. 대표적으로 따옴표류가 있지요. 위의 정규식을 자세히 보시면 따옴표가 열릴때와 닫힐때의 구분이 없는 따옴표입니다. 헌데, 요런 따옴표도 존재합니다. **“”‘’** 요런 친구들.
허용해야 할 문자들이 입력이 안되어 찾아보니 저런 친구들이 몇 있더군요. 그래서 그런 문자들도 정규식에 추가해주었습니다.

```js
// ￦“”‘’ 요 친구들이 추가되었습니다
const regex = /[^ㄱ-ㅎㅏ-ㅣ가-힣a-zA-Z0-9₩￦~!@#$%^&*()_+\-=[\]{}`<>,.?/|\\'"“”‘’:;\s]/g
```

## 모음이 입력이 안된다구요?
그리고 한 숨 돌리고 있던차에 테스트중이던 안드로이드 기기에서 모음 입력이 안된다는 제보가 들어옵니다.

> 제보자 : 천지인 키보드에서 모음이 입력이 안되요
> 나 : ?

고백컨데, 저는 천지인을 사용해본 적이 없었습니다. ~~비겁한 변명입니다~~ 천지인의 땅과 사람은 문제가 없었는데 하늘, 즉 점이 문제였습니다. ㅣ 또는 ㅡ 로 시작하는 모음을 입력할 때는 문제가 없었지만 . 부터 찍어야 하는 모음은 모음이 완성되기 전에 `textarea`에 middle dot이 찍히는 것이죠. 그래서 'ㅓ'나 'ㅗ' 따위의 모음을 입력할 수 없는 문제가 있었습니다. 
다행히 이 이슈는 오래전부터 많은 선구자분들이 탐구해온 문제였습니다. 구글링을 조금만 해보면 해결책을 찾을 수 있습니다. 각종 키보드제조사의 middle dot을 정규식에 추가하는 것이죠.

```js
// \u318D\u119E\u11A2\u2022\u2025\u00B7\uFE55 요 친구들이 추가되었습니다
const regex = /[^ㄱ-ㅎㅏ-ㅣ가-힣a-zA-Z0-9₩￦~!@#$%^&*()_+\-=[\]{}`<>,.?/|\\'"“”‘’:;\s\u318D\u119E\u11A2\u2022\u2025\u00B7\uFE55]/g
```

## 사실 하이라이트는 이겁니다
이제 정말 끝난줄 알았는데. 나는 정말 그런줄 알았는데. 하이라이트는 따로 있었습니다. 아이폰의 천지인 키보드에서 모음이 제대로 입력되지 않았습니다. 뭔가 새로운 middle dot이 있는건가 했는데, 이친구는 그게 아니었습니다.

'가격'이라는 글자를 입력한다고 가정해봅시다. '각'까지 입력하고 'ㅕ'를 입력하기 위해 .을 찍으면, 안드로이드의 천지인은 '각.' 으로 입력됩니다. 아이폰은 아닙니다. '가ㄱ.' 으로 입력됩니다. 여기서 문제는 저 '.'이 아니라, 종성에서 초성의 위치로 튀어나온 'ㄱ'입니다. 우리가 키보드로 입력하는 'ㄱ'과 저 'ㄱ'은 서로 다른 'ㄱ'입니다. ~~(왜그랬어요 애플)~~

그래서, 아래처럼 한글 자모 코드도 추가해줘야 합니다.

```js
// \u1100-\u1112 가 추가되었습니다
const regex = /[^\u1100-\u1112ㄱ-ㅎㅏ-ㅣ가-힣a-zA-Z0-9₩￦~!@#$%^&*()_+\-=[\]{}`<>,.?/|\\'"“”‘’:;\s\u318D\u119E\u11A2\u2022\u2025\u00B7\uFE55]/g
```

## 정말 이게 끝일까
이렇게 이슈는 일단락되었지만, 사실 언제 새로운 이슈가 발생해도 이상하지 않은 영역인듯 합니다. 가상키보드는 무궁무진하니까요. 
그러니 이 글을 보시는 여러분은 꼭 요구사항을 잘 확인하신 후, "특정 특수문자만 입력을 막는" 형태로 협상을 시도합시다. 아니면 구현중 필터링 할 시점을 문자가 완성된 뒤 (change이벤트?) 로 미룰 수 있게 협상을 시도하는것도 괜찮을 것 같습니다. 그것도 안되면, 모바일에서 달아납시다.